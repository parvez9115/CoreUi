<p-toast key="toast1"></p-toast>
<button cButton class="floatingButton" (click)="export()" title="Export">
  <i
    class="pi pi-file-excel"
    style="font-size: x-large; margin: 4px 0px 0px 1px"
  ></i>
</button>
<div
  *ngIf="isEdit == true || pagePermission.add.value == true"
  [visible]="visible"
  cCollapse
>
  <c-card class="mt-3 shadow">
    <c-card-body>
      <form
        [formGroup]="saveAdvancePayment"
        style="display: grid; grid-template-columns: 1fr 1fr; column-gap: 10px"
      >
        <!-- <c-col
            sm="6"
            style="
              background-color: #d8dbe0;
              border: 1px solid rgb(202, 202, 202);
              border-radius: 5px;
              display: flex;
              max-width: max-content;
              align-items: center;
              padding: 0px 0px 0px 6px;
              margin-bottom: 15px;
              margin-left: 11px;
              margin-right: 10px;
            
              height: 31px;
            "
          >
          
            <label style="margin-right: 10px">Select Company</label>

            <p-dropdown
              #companyDropdown
              autoWidth="false"
              [style]="{ width: '345px', height: '4.8vh' }"
              [options]="companies"
              formControlName="companyname"
              optionLabel="companyname"
              optionValue="companyname"
              [showClear]="true"
              placeholder="You are ordering for"
            ></p-dropdown>
          </c-col> -->
        <c-col *ngIf="pagePermission.orderforcompany.value">
          <c-input-group class="mb-3" sizing="sm">
            <span
              style="width: 24%"
              cInputGroupText
              id="basic-addon1"
              style="width: 26%"
              >Select Company</span
            >
            <div style="width: 74%">
              <p-dropdown
                #companyDropdown
                autoWidth="false"
                [style]="{
                  width: '100%',
                  height: '4.8vh',
                }"
                [options]="companies"
                formControlName="companyname"
                optionLabel="companyname"
                optionValue="companyname"
                [showClear]="true"
                placeholder="Select a company"
              ></p-dropdown>
            </div>
          </c-input-group>
        </c-col>
        <c-col>
          <c-input-group class="mb-3" sizing="sm">
            <span style="width: 24%" cInputGroupText id="basic-addon1"
              >UTR Number</span
            >
            <input
              aria-describedby="basic-addon1"
              aria-label="Account No"
              formControlName="accountno"
              cFormControl
              placeholder="Enter the UTR number"
            />
          </c-input-group>
        </c-col>

        <c-col>
          <c-input-group class="mb-3" sizing="sm">
            <span style="width: 26%" cInputGroupText id="basic-addon1"
              >Total Amount</span
            >
            <input
              aria-describedby="basic-addon1"
              aria-label="Total Amount"
              type="number"
              formControlName="totalamount"
              cFormControl
              placeholder="Enter the total amount"
            />
          </c-input-group>
        </c-col>
        <c-col
          *ngIf="saveAdvancePayment.controls['date'] as ctrl"
          style="position: relative"
        >
          <c-input-group sizing="sm">
            <span style="width: 24%" cInputGroupText id="basic-addon1"
              >Date</span
            >
            <input
              aria-describedby="basic-addon1"
              [max]="maxDate"
              aria-label="Date"
              [max]="maxDate"
              formControlName="date"
              cFormControl
              type="date"
            />
          </c-input-group>
          <div
            style="
              position: absolute;
              font-size: 12px;
              margin-left: 8px;
              color: red;
            "
            *ngIf="ctrl['errors']"
          >
            Enter a valid year
          </div>
        </c-col>
        <c-col>
          <c-input-group class="mb-3" sizing="sm">
            <span style="width: 26%" cInputGroupText id="basic-addon1"
              >Remarks</span
            >
            <textarea
              placeholder="Enter the remarks"
              cFormControl
              formControlName="remarks"
              id="exampleFormControlTextarea1"
              rows="1"
            ></textarea>
          </c-input-group>
        </c-col>
      </form>
      <!-- <div style="display: flex; justify-content: center">
        <div>
          <button
            style="margin-right: 10px"
            size="sm"
            cButton
            color="primary"
            (click)="isEdit ? save('edit') : save('save')"
            [disabled]="!saveAdvancePayment.valid"
            variant="outline"
          >
            {{ isEdit ? "Save" : "Submit" }}
          </button>
        </div>
        <div>
          <button
            size="sm"
            style="margin-left: 10px"
            cButton
            (click)="clear()"
            color="dark"
            variant="outline"
          >
            Clear
          </button>
        </div>
      </div> -->

      <div class="d-flex justify-content-center">
        <button
          type="submit"
          class="btn btn-primary"
          (click)="isEdit ? save('edit') : save('save')"
          [disabled]="!saveAdvancePayment.valid"
        >
          {{ isEdit ? "Save" : "Submit" }}
        </button>
        <div style="width: 10px"></div>
        <button type="button" class="btn btn-secondary" (click)="clear()">
          Clear
        </button>
      </div>
    </c-card-body>
  </c-card>
</div>

<c-row
  style="
    justify-content: end;
    margin-top: 10px;
    margin-bottom: 10px;
    margin-right: 0px;
    margin-left: 0px;
  "
>
  <button
    (click)="toggleCollapse()"
    size="sm"
    cButton
    color="primary"
    *ngIf="pagePermission.add.value"
  >
    <svg cIcon name="{{ visible ? 'cilArrowTop' : 'cilArrowBottom' }}"></svg>
    {{ visible ? "Close" : "Open" }}
  </button>
</c-row>
<c-card *ngIf="pagePermission.view.value == true" class="mb-4">
  <div style="display: flex; justify-content: flex-end">
    <span class="p-input-icon-left" style="width: 40%; margin: 5px">
      <i class="pi pi-search"></i>
      <input
        type="text"
        pInputText
        (change)="gridPagination.checkSearch($event)"
        (keyup.enter)="handlePagination('first')"
        [(ngModel)]="gridPagination.searchTerm"
        style="width: 100%"
        placeholder="Search grid"
      />
      <i
        class="pi pi-times"
        style="right: 4%;cursor: pointer;"
        (click)="
         gridPagination.searchTerm = '';
          gridPagination.isSearched?handlePagination('first'):null;
          gridPagination.isSearched=false;
        "
      ></i>
    </span>
    <button
      style="margin: 5px"
      type="submit"
      class="btn btn-primary"
      (click)="handlePagination('first')"
      [disabled]="
        gridPagination.searchTerm == undefined ||
        gridPagination.searchTerm == ''
      "
    >
      Search
    </button>
  </div>
  <ag-grid-angular
    #myGrid
    style="height: 100vh"
    class="ag-theme-alpine"
    [rowData]="rowData"
    [columnDefs]="columnDefs"
    [defaultColDef]="defaultColDef"
    (gridReady)="onGridReady($event)"
    rowAnimation
    enableCellTextSelection
  >
  </ag-grid-angular>
  <div class="paginationContainer">
    <span class="paginationText">{{
      gridPagination.totalRecords!=0? gridPagination.currentPage * 100 + 1:0
    }}</span>
    to <span class="paginationText">{{ gridPagination.toRecord }}</span> of
    <span class="paginationText">{{ gridPagination.totalRecords }}</span>
    <div style="display: flex; align-items: center">
      <i
        class="pi pi-fast-backward paginationIcon"
        (click)="handlePagination('first')"
      ></i>
      <i
        class="pi pi-caret-left paginationIcon"
        (click)="handlePagination('previous')"
      ></i>
      Page
      <span class="paginationText">{{ gridPagination.currentPage + 1 }}</span>
      of {{ gridPagination.totalPages + 1 }}
      <i
        class="pi pi-caret-right paginationIcon"
        (click)="handlePagination('next')"
      ></i>
      <i
        class="pi pi-fast-forward paginationIcon"
        (click)="handlePagination('last')"
      ></i>
    </div>
  </div>
</c-card>

<c-modal
  [visible]="endisConfirm"
  #verticallyCenteredModal
  alignment="center"
  (visibleChange)="handleYear($event)"
>
  <c-modal-header>
    <h5 cModalTitle>Confirm</h5>
    <button (click)="toggleConfirm()" cButtonClose></button>
  </c-modal-header>
  <c-modal-body>Are you sure you want to delete ?</c-modal-body>
  <c-modal-footer>
    <button (click)="delete()" cButton color="primary">Yes</button>
    <button (click)="toggleConfirm()" cButton color="secondary">No</button>
  </c-modal-footer>
</c-modal>

<c-modal
  [visible]="activateModalToggle"
  (visibleChange)="handleActivateModalChange($event)"
  #verticallyCenteredModal
  alignment="center"
>
  <c-modal-header>
    <h5 cModalTitle>Confirm</h5>
    <button (click)="toggleActivateModal()" cButtonClose></button>
  </c-modal-header>
  <c-modal-body>Are you sure you want to accept ?</c-modal-body>
  <c-modal-footer>
    <button (click)="accepted()" cButton color="primary">Yes</button>
    <button (click)="toggleActivateModal()" cButton color="secondary">
      No
    </button>
  </c-modal-footer>
</c-modal>

<c-modal
  [visible]="rejectModalToggle"
  (visibleChange)="handleRejectModalChange($event)"
  #verticallyCenteredModal
  alignment="center"
>
  <c-modal-header>
    <h5 cModalTitle>Reject Confirm</h5>
    <button (click)="toggleRejectModal()" cButtonClose></button>
  </c-modal-header>

  <c-modal-body>
    <textarea
      [(ngModel)]="reason"
      class="textArea"
      style="margin-top: 4px; border: none; resize: none"
      placeholder="Enter the Reason"
      rows="4"
      cols="60"
      cFormControl
      id="exampleFormControlTextarea1"
    ></textarea>
  </c-modal-body>
  <c-modal-footer>
    <button
      (click)="rejected()"
      [disabled]="reason == '' || reason == undefined"
      cButton
      color="primary"
    >
      Yes
    </button>
    <button (click)="toggleRejectModal()" cButton color="secondary">No</button>
  </c-modal-footer>
</c-modal>

<c-modal
  [visible]="rejectedModalToggle"
  #verticallyCenteredModal
  alignment="center"
>
  <c-modal-header>
    <h5 cModalTitle>Rejected Details</h5>
    <button (click)="Rejectedtoggle()" cButtonClose></button>
  </c-modal-header>
  <c-modal-body>
    <textarea
      [(ngModel)]="reason"
      class="textArea"
      style="margin-top: 4px; border: 4px solid #ccc7f6; resize: none"
      rows="4"
      cols="60"
      cFormControl
      readonly
      id="exampleFormControlTextarea1"
    ></textarea>
  </c-modal-body>
</c-modal>
